var userEmail,userId,imagekit=new ImageKit({publicKey:"public_RlHiFa9SqYHuddoOjFik0FyCAg8=",urlEndpoint:"https://ik.imagekit.io/6camnbsww"});let photoData={email:"",id:"",logoUrl:"",previewUrl:""};function generateUniqueId(){return"ID_"+Math.random().toString(36).substr(2,9)}function assignUserId(email){return userId=generateUniqueId(),photoData.email=email,photoData.id=userId,userId}function upload(event){event.preventDefault(),["logo","preview"].forEach((id=>{var image=croppedImages[id];if(image){var blob=dataURLtoBlob(image);toggleIconState(id,"loading"),google.script.run.withSuccessHandler((auth=>{uploadImage(auth,blob,id+".png",((err,result)=>{err?(console.error(`${id} yükleme hatası:`,err),toggleIconState(id,"add")):(console.log(`${id} başarıyla yüklendi:`,result),toggleIconState(id,"done"),"logo"===id?photoData.logoUrl=result.url:"preview"===id&&(photoData.previewUrl=result.url),photoData.logoUrl&&photoData.previewUrl&&showDoneMessage())}))})).generateSignature()}}))}function uploadImage(auth,blob,fileName,callback){imagekit.upload({file:blob,fileName:fileName,token:auth.token,signature:auth.signature,expire:auth.expire},(function(err,result){callback(err,result)}))}function dataURLtoBlob(dataurl){for(var arr=dataurl.split(","),mime=arr[0].match(/:(.*?);/)[1],bstr=atob(arr[1]),n=bstr.length,u8arr=new Uint8Array(n);n--;)u8arr[n]=bstr.charCodeAt(n);return new Blob([u8arr],{type:mime})}function checkUserEmail(email){return!(!email||!email.endsWith("@atolye15.com"))||(showErrorMessage(),!1)}function showErrorMessage(){const uploadForm=document.querySelector(".upload-box"),errorBox=document.querySelector(".error");uploadForm.style.display="none",errorBox.style.display="flex"}function reupload(){document.querySelector(".done-resize").style.display="none";document.querySelector(".upload-box").style.display="flex"}function showDoneMessage(){document.querySelector(".upload-box").style.display="none";document.querySelector(".done-resize").style.display="flex"}function toggleIconState(idPrefix,state){const addIcon=document.querySelector(`.${idPrefix} .add`),loadingIcon=document.querySelector(`.${idPrefix} .loading`),doneIcon=document.querySelector(`.${idPrefix} .done`);addIcon.style.display="add"===state?"block":"none",loadingIcon.style.display="loading"===state?"block":"none",doneIcon.style.display="done"===state?"block":"none"}function updateFileName(inputId){const inputElement=document.getElementById(inputId),spanElement=inputElement.previousElementSibling.querySelector("span");inputElement.addEventListener("change",(function(){const fileName=inputElement.files[0]?.name||"No file selected";spanElement.textContent=fileName}))}document.querySelector(".primary-btn").addEventListener("click",reupload),google.script.run.withSuccessHandler((function(email){checkUserEmail(email)&&(assignUserId(email),document.querySelector(".upload-box").style.display="flex")})).getUserEmail(),updateFileName("logo"),updateFileName("preview");